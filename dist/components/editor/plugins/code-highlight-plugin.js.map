{"version":3,"file":"code-highlight-plugin.js","names":["useLexicalComposerContext","$isCodeNode","CodeNode","$getRoot","useEffect","generateGutter","content","lines","split","map","_","index","join","CodeHighlightPlugin","$","_c","_useLexicalComposerCo","_useLexicalComposerCo2","_slicedToArray","editor","t0","t1","updateCodeBlocks","root","codeNodes","getChildren","forEach","child","push","codeNode","textContent","getTextContent","gutter","domElement","getElementByKey","getKey","HTMLElement","setAttribute","unregisterListener","registerUpdateListener","t2","editorState","read","unregisterMutationListener","registerMutationListener","mutatedNodes","_iterator","_createForOfIteratorHelper","_step","_loop","_step$value","value","nodeKey","mutation","getEditorState","node","_nodeMap","get","textContent_0","gutter_0","domElement_0","s","n","done","err","e","f"],"sources":["../../../../src/components/editor/plugins/code-highlight-plugin.tsx"],"sourcesContent":["import { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $isCodeNode, CodeNode } from '@lexical/code';\nimport { $getRoot } from 'lexical';\nimport { useEffect } from 'react';\n\nfunction generateGutter(content: string): string {\n  const lines = content.split('\\n');\n  return lines.map((_, index) => index + 1).join('\\n');\n}\n\nexport function CodeHighlightPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    const updateCodeBlocks = () => {\n      const root = $getRoot();\n      const codeNodes: CodeNode[] = [];\n\n      // Collect all code nodes\n      root.getChildren().forEach(child => {\n        if ($isCodeNode(child)) {\n          codeNodes.push(child);\n        }\n      });\n\n      // Update each code node's DOM element\n      codeNodes.forEach(codeNode => {\n        const textContent = codeNode.getTextContent();\n        const gutter = generateGutter(textContent);\n        const domElement = editor.getElementByKey(codeNode.getKey());\n\n        if (domElement && domElement instanceof HTMLElement) {\n          domElement.setAttribute('data-gutter', gutter);\n        }\n      });\n    };\n\n    const unregisterListener = editor.registerUpdateListener(\n      ({ editorState }) => {\n        editorState.read(() => {\n          updateCodeBlocks();\n        });\n      }\n    );\n\n    // Register a mutation listener for better performance\n    const unregisterMutationListener = editor.registerMutationListener(\n      CodeNode,\n      mutatedNodes => {\n        for (const [nodeKey, mutation] of mutatedNodes) {\n          if (mutation === 'updated' || mutation === 'created') {\n            editor.getEditorState().read(() => {\n              const node = editor.getEditorState()._nodeMap.get(nodeKey);\n              if ($isCodeNode(node)) {\n                const textContent = node.getTextContent();\n                const gutter = generateGutter(textContent);\n                const domElement = editor.getElementByKey(nodeKey);\n\n                if (domElement && domElement instanceof HTMLElement) {\n                  domElement.setAttribute('data-gutter', gutter);\n                }\n              }\n            });\n          }\n        }\n      }\n    );\n\n    // Initial update\n    editor.getEditorState().read(() => {\n      updateCodeBlocks();\n    });\n\n    return () => {\n      unregisterListener();\n      unregisterMutationListener();\n    };\n  }, [editor]);\n\n  return null;\n}\n"],"mappings":"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","ignoreList":[]}